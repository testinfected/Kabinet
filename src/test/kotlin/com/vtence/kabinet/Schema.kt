package com.vtence.kabinet

import Product

object Products : Table("products") {
    val id = int("id").autoGenerated()
    val number = string("number")
    val name = string("name")
    val description = string("description").nullable()
}


object Items : Table("items") {
    val id = int("id").autoGenerated()
    val number = string("number")
}


private fun dehydrate(product: Product): Products.(Dataset) -> Unit = {
    it[number] = product.number
    it[description] = product.description
    it[name] = product.name
}

private fun Products.hydrate(row: ResultRow): Product {
    return Product(
        id = row[id],
        number = row[number],
        name = row[name],
        description = row[description]
    )
}

val Product.record: Products.(Dataset) -> Unit
    get() = dehydrate(this)

val ResultRow.product: Product
    get() = Products.hydrate(this)

fun ResultRow.product(alias: String): Product = rebase(Products.alias(alias)).product
